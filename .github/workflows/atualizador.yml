name: Atualizar Dados Parlamentares Diariamente

# Quando esse rob么 vai rodar?
on:
  schedule:
    # Roda todo dia s 06:00 UTC (que d谩 umas 03:00 da madrugada no Brasil)
    - cron: '0 6 * * *'
  # Isso cria um bot茫o m谩gico no GitHub para voc锚 rodar manualmente quando quiser!
  workflow_dispatch: 

jobs:
  atualizar_csvs:
    runs-on: ubuntu-latest

    steps:
    # 1. O rob么 da nuvem baixa os arquivos do seu reposit贸rio
    - name: Clonar o reposit贸rio
      uses: actions/checkout@v4

    # 2. Ele instala o Python na m谩quina virtual
    - name: Configurar o Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.10'

    # 3. Ele l锚 o seu requirements.txt para instalar o pandas, requests, etc.
    - name: Instalar bibliotecas
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt

    # 4. Ele roda o rob么 das despesas
    - name: Rodar Rob么 de Notas Fiscais (Ranking)
      run: python robo_ranking.py

    # 5. Ele roda o rob么 dos sal谩rios
    - name: Rodar Rob么 de Sal谩rios
      run: python robo_salarios.py

    # 6. Ele pega os CSVs novos gerados e salva de volta no GitHub
    - name: Salvar no GitHub e Sincronizar com Hugging Face
      env:
        HF_TOKEN: ${{ secrets.HF_TOKEN }}
      run: |
        git config --global user.name "Rob么 Mil Grau"
        git config --global user.email "actions@github.com"
        git add *.csv
        git diff --quiet && git diff --staged --quiet || git commit -m " Atualiza莽茫o di谩ria autom谩tica"
        git push origin main
        
        # A M谩gica: Empurrando a c贸pia para o Hugging Face
        git remote add space https://filip3dr:$HF_TOKEN@huggingface.co/spaces/filip3dr/parlamento-mil-grau
        git push --force space main
